<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SecureScan - Client-side Scanner (Regex + JS AST)</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --danger: #e74c3c;
            --warning: #f39c12;
            --success: #2ecc71;
            --light: #ecf0f1;
            --dark: #34495e;
        }
        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color:#f5f7fa; color:#333; line-height:1.6; }
        .container{ max-width:1200px; margin:0 auto; padding:20px; }
        header{ background:linear-gradient(135deg,var(--primary) 0%, var(--dark) 100%); color:white; padding:2rem; text-align:center; border-radius:10px; margin-bottom:30px; box-shadow:0 4px 15px rgba(0,0,0,0.1); }
        h1{ margin-bottom:10px; font-size:2.2rem; }
        .subtitle{ color:var(--light); font-weight:300; font-size:1.05rem; }
        .upload-section{ background:white; padding:24px; border-radius:10px; box-shadow:0 4px 15px rgba(0,0,0,0.08); margin-bottom:20px; text-align:center; }
        .drop-zone{ border:3px dashed var(--secondary); border-radius:10px; padding:28px 20px; margin:18px 0; cursor:pointer; transition:all .2s; }
        .drop-zone:hover{ background-color:rgba(52,152,219,0.04); transform:translateY(-2px); }
        .drop-zone.dragover{ background-color:rgba(52,152,219,0.08); border-color:var(--primary); transform:scale(1.01); }
        .drop-zone i{ font-size:2.6rem; color:var(--secondary); margin-bottom:12px; display:block; }
        .file-input{ display:none; }
        .browse-btn{ background:var(--secondary); color:white; padding:10px 18px; border:none; border-radius:6px; cursor:pointer; font-size:1rem; margin-top:10px; }
        .scan-btn{ background:var(--success); color:white; padding:12px 28px; border:none; border-radius:6px; cursor:pointer; font-size:1rem; margin-top:16px; }
        .scan-btn:disabled{ background:#95a5a6; cursor:not-allowed; }
        .file-list{ margin-top:18px; text-align:left; }
        .file-item{ display:flex; justify-content:space-between; align-items:center; padding:10px 12px; background:#f8f9fa; margin-bottom:10px; border-radius:6px; }
        .file-name{ font-weight:500; display:flex; align-items:center; }
        .file-name i{ margin-right:10px; color:var(--secondary); }
        .file-size{ color:#7f8c8d; font-size:0.9rem; }
        .loading{ display:none; text-align:center; margin:20px 0; }
        .spinner{ border:4px solid rgba(0,0,0,0.08); border-left:4px solid var(--secondary); border-radius:50%; width:36px; height:36px; animation:spin 1s linear infinite; margin:0 auto 12px; }
        @keyframes spin{ 0%{ transform:rotate(0deg) } 100%{ transform:rotate(360deg) } }
        .results-section{ display:none; background:white; padding:22px; border-radius:10px; box-shadow:0 4px 15px rgba(0,0,0,0.08); margin-bottom:20px; }
        .vulnerability-list{ list-style:none; margin-top:12px; }
        .vulnerability-item{ padding:14px; margin-bottom:12px; border-radius:8px; border-left:5px solid var(--warning); background:#fff; box-shadow:0 3px 8px rgba(0,0,0,0.04); }
        .vulnerability-item.critical{ border-left-color:var(--danger); }
        .vulnerability-item.high{ border-left-color:var(--warning); }
        .vulnerability-item.medium{ border-left-color:var(--secondary); }
        .vulnerability-item.low{ border-left-color:var(--success); }
        .vuln-title{ display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
        .vuln-type{ font-weight:700; font-size:1.05rem; }
        .vuln-severity{ padding:6px 10px; border-radius:18px; font-size:0.85rem; font-weight:700; }
        .severity-critical{ background-color:rgba(231,76,60,0.12); color:var(--danger); }
        .severity-high{ background-color:rgba(243,156,18,0.12); color:var(--warning); }
        .severity-medium{ background-color:rgba(52,152,219,0.12); color:var(--secondary); }
        .severity-low{ background-color:rgba(46,204,113,0.12); color:var(--success); }
        .vuln-location{ color:#7f8c8d; margin-bottom:8px; font-size:0.95rem; }
        .vuln-description{ margin-bottom:10px; line-height:1.4; }
        .vuln-remediation{ background:#f8f9fa; padding:10px; border-radius:6px; font-size:0.95rem; border-left:4px solid var(--secondary); }
        footer{ text-align:center; margin-top:30px; color:#7f8c8d; font-size:0.95rem; padding:12px; border-top:1px solid #eee; }
        .alert{ padding:12px 16px; margin-bottom:12px; border-radius:8px; display:none; }
        .alert-error{ background:#ffebee; color:#c62828; border:1px solid #ffcdd2; }
        .alert-success{ background:#e8f5e9; color:#2e7d32; border:1px solid #c8e6c9; }
        .stats{ display:flex; justify-content:space-around; margin:12px 0; flex-wrap:wrap; }
        .stat-box{ background:white; padding:12px; border-radius:8px; text-align:center; min-width:140px; margin:8px; box-shadow:0 3px 8px rgba(0,0,0,0.06); }
        .stat-value{ font-size:1.6rem; font-weight:700; margin-top:6px; }
        @media (max-width:768px){ .container{ padding:12px } header{ padding:1.2rem } h1{ font-size:1.6rem } .upload-section,.results-section{ padding:14px } .stats{ flex-direction:column }}
    </style>

    <!-- Esprima for JS AST parsing (client-side) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/esprima/4.0.1/esprima.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-shield-alt"></i> SecureScan</h1>
            <p class="subtitle">Client-side (demo) scanner â€” regex + JS AST checks</p>
        </header>

        <div class="alert" id="alertBox"></div>

        <section class="upload-section">
            <h2>Upload Your Source Code</h2>
            <p>Supported: .js, .java, .py, .php, .html, .css, .xml, .json, .txt</p>

            <div class="drop-zone" id="dropZone">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Drag & drop files here or</p>
                <input type="file" id="fileInput" class="file-input" multiple accept=".js,.java,.py,.php,.html,.css,.xml,.json,.txt">
                <button class="browse-btn" id="browseBtn">Browse Files</button>
            </div>

            <div class="file-list" id="fileList"></div>
            <button class="scan-btn" id="scanBtn" disabled>Scan for Vulnerabilities</button>
        </section>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing your code for vulnerabilities...</p>
        </div>

        <section class="results-section" id="resultsSection">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h2>Scan Results</h2>
                <div id="vulnCount" style="font-weight:700; color:var(--dark)">0 vulnerabilities found</div>
            </div>

            <div class="stats" id="statsContainer">
                <div class="stat-box">
                    <div>Critical</div>
                    <div class="stat-value" id="criticalCount">0</div>
                </div>
                <div class="stat-box">
                    <div>High</div>
                    <div class="stat-value" id="highCount">0</div>
                </div>
                <div class="stat-box">
                    <div>Medium</div>
                    <div class="stat-value" id="mediumCount">0</div>
                </div>
                <div class="stat-box">
                    <div>Low</div>
                    <div class="stat-value" id="lowCount">0</div>
                </div>
            </div>

            <ul class="vulnerability-list" id="vulnerabilityList"></ul>
        </section>

        <footer>
            <p>SecureScan - Demo client-side vulnerability detection (regex + JS AST). Not a replacement for server-side scanning tools.</p>
        </footer>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const browseBtn = document.getElementById('browseBtn');
        const scanBtn = document.getElementById('scanBtn');
        const fileList = document.getElementById('fileList');
        const loading = document.getElementById('loading');
        const resultsSection = document.getElementById('resultsSection');
        const vulnerabilityList = document.getElementById('vulnerabilityList');
        const vulnCount = document.getElementById('vulnCount');
        const alertBox = document.getElementById('alertBox');
        const criticalCount = document.getElementById('criticalCount');
        const highCount = document.getElementById('highCount');
        const mediumCount = document.getElementById('mediumCount');
        const lowCount = document.getElementById('lowCount');

        let uploadedFiles = [];

        // --------- Patterns (regex) ----------
        const SECRET_PATTERNS = [
            { name: "Hardcoded API Key", regex: /\b(api[_-]?key|client[_-]?secret|secret[_-]?key)\s*[:=]\s*['"][A-Za-z0-9\-\._\/\+]{8,}['"]/i, severity: "critical",
              desc: "Possible hardcoded API key or secret detected.", rem: "Move secrets to environment variables or secret store." },
            { name: "AWS Access Key", regex: /\bAKIA[0-9A-Z]{16}\b/, severity: "critical",
              desc: "Possible AWS access key pattern found.", rem: "Rotate key and use IAM roles or env vars." },
            { name: "Private Key PEM", regex: /-----BEGIN (RSA|OPENSSL|PRIVATE) KEY-----/i, severity: "critical",
              desc: "Private key material detected.", rem: "Remove private keys and store securely." },
            { name: "Hardcoded Password", regex: /\b(password|pwd)\s*[:=]\s*['"][^'"]{4,}['"]/i, severity: "critical",
              desc: "Hardcoded password detected.", rem: "Use environment variables or a vault." },
        ];

        const SQL_LIKE = [
            { name: "Concatenated SQL", regex: /(["'`].*SELECT.*FROM.*["'`]\s*\+|\bexecute\([^)]*["'`].*SELECT.*FROM.*\+|\bfstring:.*SELECT.*FROM)/i, severity: "high",
              desc: "Possible SQL built by concatenation or template with variables.", rem: "Use parameterized queries / prepared statements." }
        ];

        const XSS_LIKE = [
            { name: "DOM write (dangerous)", regex: /\b(document\.write|innerHTML\s*=\s*|outerHTML\s*=\s*|insertAdjacentHTML\s*\()/i, severity: "high",
              desc: "Possible unsafe DOM write detected.", rem: "Sanitize input and prefer textContent or safe templating." }
        ];

        const GENERIC = [
            { name: "Eval or Exec (generic)", regex: /\b(eval|exec|execfile)\s*\(/i, severity: "high",
              desc: "Use of eval/exec detected.", rem: "Avoid eval/exec; use safer alternatives." }
        ];

        // ------- UI event wiring ----------
        browseBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelect);

        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
        dropZone.addEventListener('drop', (e) => { e.preventDefault(); dropZone.classList.remove('dragover'); if (e.dataTransfer.files.length) handleFiles(e.dataTransfer.files); });

        scanBtn.addEventListener('click', startScan);

        function showAlert(message, type='error') {
            alertBox.textContent = message;
            alertBox.className = `alert alert-${type}`;
            alertBox.style.display = 'block';
            setTimeout(()=> alertBox.style.display='none', 5000);
        }

        function handleFileSelect(e) { handleFiles(e.target.files); }

        function handleFiles(files) {
            for (let i=0;i<files.length;i++) {
                const file = files[i];
                if (uploadedFiles.some(f => f.name === file.name && f.size === file.size)) continue;
                const extension = file.name.split('.').pop().toLowerCase();
                const allowed = ['js','java','py','php','html','css','xml','json','txt'];
                if (!allowed.includes(extension)) { showAlert(`Not supported: ${file.name}`); continue; }
                uploadedFiles.push(file);
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `<span class="file-name"><i class="fas fa-file-code"></i> ${file.name}</span><span class="file-size">${formatFileSize(file.size)}</span>`;
                fileList.appendChild(fileItem);
            }
            scanBtn.disabled = uploadedFiles.length === 0;
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes+' bytes';
            else if (bytes < 1048576) return (bytes/1024).toFixed(1)+' KB';
            else return (bytes/1048576).toFixed(1)+' MB';
        }

        // ---------- Main scan flow ----------
        function startScan() {
            if (uploadedFiles.length === 0) { showAlert('Upload files first','error'); return; }
            loading.style.display = 'block';
            resultsSection.style.display = 'none';
            vulnerabilityList.innerHTML = '';
            scanBtn.disabled = true;
            // read all files
            Promise.all(uploadedFiles.map(f => fileToText(f).then(txt => ({ file: f, text: txt })) ))
                .then(fileObjs => {
                    const allFindings = [];
                    for (const fo of fileObjs) {
                        const ext = fo.file.name.split('.').pop().toLowerCase();
                        const findings = analyzeContent(fo.file.name, fo.text, ext);
                        findings.forEach(x => allFindings.push(x));
                    }
                    // done
                    loading.style.display = 'none';
                    displayResults(allFindings);
                })
                .catch(err => {
                    loading.style.display = 'none';
                    showAlert('Error reading files: ' + String(err), 'error');
                    scanBtn.disabled = false;
                });
        }

        function fileToText(file) {
            return new Promise((resolve, reject) => {
                const r = new FileReader();
                r.onload = () => resolve(String(r.result));
                r.onerror = () => reject(r.error);
                r.readAsText(file);
            });
        }

        // ---------- Detection logic ----------
        function analyzeContent(filename, text, ext) {
            const findings = [];

            // 1) Generic regex checks (secrets, SQL-like, XSS-like, eval)
            const checks = [...SECRET_PATTERNS, ...SQL_LIKE, ...XSS_LIKE, ...GENERIC];
            checks.forEach(c => {
                const match = c.regex.exec(text);
                if (match) {
                    const line = getLineNumber(text, match.index);
                    findings.push({
                        type: c.name,
                        severity: c.severity,
                        file: filename,
                        line: line,
                        description: c.desc || 'Pattern matched',
                        remediation: c.rem || 'Review and remediate'
                    });
                }
            });

            // 2) Language-specific heuristics
            if (ext === 'js') {
                // AST-based checks using Esprima
                try {
                    const ast = esprima.parseScript(text, { loc: true, tolerant: true });
                    // traverse nodes
                    traverseAST(ast, node => {
                        // eval() call
                        if (node.type === 'CallExpression' && node.callee && node.callee.type === 'Identifier' && node.callee.name === 'eval') {
                            findings.push({
                                type: 'Use of eval()',
                                severity: 'critical',
                                file: filename,
                                line: node.loc ? node.loc.start.line : '-',
                                description: 'eval() invocation detected; dynamic code execution is risky.',
                                remediation: 'Avoid eval(); use safer parsing or functions.'
                            });
                        }
                        // assignment to innerHTML
                        if (node.type === 'AssignmentExpression' && node.left && node.left.type === 'MemberExpression' && node.left.property && node.left.property.type === 'Identifier' && node.left.property.name === 'innerHTML') {
                            findings.push({
                                type: 'innerHTML assignment',
                                severity: 'high',
                                file: filename,
                                line: node.loc ? node.loc.start.line : '-',
                                description: 'Assignment to innerHTML detected; could enable XSS if value is untrusted.',
                                remediation: 'Sanitize inputs or use textContent/escaping.'
                            });
                        }
                        // document.write
                        if (node.type === 'CallExpression' && node.callee && node.callee.type === 'MemberExpression' && node.callee.property && node.callee.property.name === 'write') {
                            // e.g., document.write(...)
                            findings.push({
                                type: 'document.write usage',
                                severity: 'high',
                                file: filename,
                                line: node.loc ? node.loc.start.line : '-',
                                description: 'document.write detected; avoid writing raw user data to DOM.',
                                remediation: 'Use safe DOM APIs and sanitize data.'
                            });
                        }
                    });
                } catch (err) {
                    // parsing errors â€” record parse error but don't block
                    findings.push({
                        type: 'JS parse error',
                        severity: 'low',
                        file: filename,
                        line: '-',
                        description: 'Esprima failed to parse the file (possible syntax not supported).',
                        remediation: 'Check file syntax or process server-side for advanced parsing.'
                    });
                }
            } else if (ext === 'py') {
                // lightweight Python heuristics via regex (client-side cannot AST-parse Python easily)
                // detect suspicious concatenation in execute-like calls
                const pySqlRegex = /\bexecute\([^)]*['"].*(\+|%|\{).*['"]\)/i;
                const pyEvalRegex = /\b(eval|exec)\s*\(/i;
                if (pySqlRegex.test(text)) {
                    const m = pySqlRegex.exec(text);
                    findings.push({
                        type: 'Python: possible SQL concatenation',
                        severity: 'high',
                        file: filename,
                        line: getLineNumber(text, m.index),
                        description: 'execute() called with string concatenation/formatting â€” possible SQL injection.',
                        remediation: 'Use parameterized queries.'
                    });
                }
                if (pyEvalRegex.test(text)) {
                    const m = pyEvalRegex.exec(text);
                    findings.push({
                        type: 'Python: eval/exec usage',
                        severity: 'high',
                        file: filename,
                        line: getLineNumber(text, m.index),
                        description: 'eval/exec detected.',
                        remediation: 'Avoid eval/exec; use safer constructs.'
                    });
                }
            } else if (ext === 'php' || ext === 'java' || ext === 'html') {
                // simple additional checks via regex already covered by SQL_LIKE / XSS_LIKE / GENERIC
                // for html, also look for on* handlers (inline events)
                if (ext === 'html') {
                    const onEvent = text.match(/\son\w+\s*=/i);
                    if (onEvent) {
                        findings.push({
                            type: 'Inline event handler',
                            severity: 'medium',
                            file: filename,
                            line: getLineNumber(text, onEvent.index),
                            description: 'Inline on* event handler detected in HTML (possible JS execution).',
                            remediation: 'Prefer unobtrusive event binding and sanitize content.'
                        });
                    }
                }
            }

            // deduplicate near-identical findings (by type+file+line)
            const unique = [];
            const seen = new Set();
            for (const f of findings) {
                const key = `${f.type}::${f.file}::${f.line}`;
                if (!seen.has(key)) { seen.add(key); unique.push(f); }
            }
            return unique;
        }

        // small AST walker for Esprima AST
        function traverseAST(node, visitor) {
            visitor(node);
            for (const key in node) {
                if (!node.hasOwnProperty(key)) continue;
                const child = node[key];
                if (Array.isArray(child)) {
                    for (const c of child) {
                        if (c && typeof c.type === 'string') traverseAST(c, visitor);
                    }
                } else if (child && typeof child.type === 'string') {
                    traverseAST(child, visitor);
                }
            }
        }

        function getLineNumber(text, idx) {
            if (idx === undefined || idx < 0) return '-';
            return text.slice(0, idx).split('\n').length;
        }

        // ---------- Display ----------
        function displayResults(vulns) {
            vulnerabilityList.innerHTML = '';
            vulnCount.textContent = `${vulns.length} vulnerabilit${vulns.length === 1 ? 'y' : 'ies'} found`;

            const severityCount = { critical:0, high:0, medium:0, low:0 };
            vulns.forEach(v => {
                const sev = (v.severity || 'low').toLowerCase();
                if (sev === 'critical') severityCount.critical++;
                else if (sev === 'high') severityCount.high++;
                else if (sev === 'medium') severityCount.medium++;
                else severityCount.low++;
            });
            criticalCount.textContent = severityCount.critical;
            highCount.textContent = severityCount.high;
            mediumCount.textContent = severityCount.medium;
            lowCount.textContent = severityCount.low;

            if (vulns.length === 0) {
                showAlert('No vulnerabilities found! (client-side heuristics)', 'success');
            } else {
                showAlert(`Scan completed. Found ${vulns.length} potential vulnerabilities.`, 'success');
            }

            // Add each vulnerability
            for (const vuln of vulns) {
                const li = document.createElement('li');
                li.className = `vulnerability-item ${ (vuln.severity || 'low').toLowerCase() }`;
                li.innerHTML = `
                    <div class="vuln-title">
                        <span class="vuln-type">${escapeHtml(vuln.type)}</span>
                        <span class="vuln-severity severity-${(vuln.severity || 'low').toLowerCase()}">${(vuln.severity || 'low').toUpperCase()}</span>
                    </div>
                    <div class="vuln-location"><i class="fas fa-file"></i> File: ${escapeHtml(vuln.file)} | Line: ${escapeHtml(String(vuln.line))}</div>
                    <div class="vuln-description">${escapeHtml(vuln.description || '')}</div>
                    <div class="vuln-remediation"><strong>Remediation:</strong> ${escapeHtml(vuln.remediation || '')}</div>
                `;
                vulnerabilityList.appendChild(li);
            }

            resultsSection.style.display = 'block';
            scanBtn.disabled = false;
        }

        function escapeHtml(s) {
            if (!s) return '';
            return s.replace(/[&<>"'`]/g, function(m) { return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;', '`':'&#96;'})[m]; });
        }

    }); // DOMContentLoaded end
    </script>
</body>
</html>
